# bluethoot_pipe_realtime_system
READ THE LICENCE TO AVOID LEGAL PROBLEM

Request to me to share this project. 




Author
Nicola Lombardi, SW HW Engineer
Computer Engineer & Senior Python Dev.
February 2025


# Real-Time 1D Position Tracking Using Named Pipes

## Project Description

This project implements a real-time data processing pipeline to track the 1D position of a cow equipped with a Bluetooth tag. The pipeline connects multiple components via **Linux named pipes (FIFOs)** and manages the flow of data from raw measurements to a filtered output.

The cow transmits Bluetooth packets through a tag; a fixed anchor receives these transmissions and computes their **Angle of Arrival (AoA)**. By knowing both the anchor's and tag's height, and after applying filtering to smooth the data, the system computes the 1D position of the cow in real time.

The workflow is composed by 5 phases:
1. Creates Linux named pipes, to facilitate communication between the 
components. 
2. Starts the aoa_to_1d and median_filter.py processes, ensuring they read 
from and write to the correct pipes. 
3. Reads input data from input.csv, writes it to the aoa_to_1d input pipe, and 
ensures the process is properly notified when input is finished. 
4. Reads the final filtered output from median_filter.py and writes it to an 
output CSV file (output.csv). 
5. Handles process cleanup and removes the named pipes after execution.



## Static Components

| File | Description |
|-------------------------|----------------------------------------------------------------------------------------------------------------|
| `aoa_to_1d.c` |         A C program that computes the 1D position from angle and height values. It reads from and writes to named pipes. |
| `median_filter.py` |    A Python script that applies a median filter on the last second's worth of position data. |
| `pipeline.py` |         The main orchestrator that creates FIFOs, launches processes, manages data flow, and handles cleanup. |
| `input.csv` |           Sample input data in CSV format. |
| `output.csv` |          Final filtered output generated by the pipeline. |
| `test_pipe.py` |        A test suite that verifies the correctness, robustness, and performance of the system. |
| `run_all.sh` |          A Bash script that automates compilation, execution, and testing. |
| `Makefile` |            Compiles `aoa_to_1d.c` into an executable using `make`. |



## Input Format

Each row in `input.csv` contains a timestamped angle measurement:

timestamp,tag_id,angle,tag_height 1733062840000,4baf351178aa9b0e,-30,1.2



## How to Run

### 1. Compilation

To compile the C component:

Run the bash script 
make
Alternatively, manually:
gcc -o aoa_to_1d aoa_to_1d.c -lm


### 2. Execute the Pipeline
Run the main Python orchestrator:

python3 pipeline.py

This creates the FIFO pipes, starts the sub-processes, streams input and output, and performs cleanup.


## How to Run the Testing for the Test Plan

A comprehensive test plan is provided in test_pipe.py, covering the following areas:

1. Creation of FIFO pipes

2. Launching of external processes

3. Data transmission between components (via files instead of FIFOs, where needed)

4. Correct processing of known input data

5. Validation of generated output

6. Cleanup of processes and FIFOs

7. Robustness to malformed or corrupted input

8. Performance under large datasets

9. Concurrency with simultaneous inputs

10. Automated test of one complete known case

Run All Tests

python3 test_pipe.py

Or run the full automation: bash

./run_all.sh

# FIFO Architecture


[input.csv]
    ↓
[input_pipe.fifo]
    ↓
[aoa_to_1d]
    ↓
[output_pipe_aoa.fifo]
    ↓
[median_filter.py]
    ↓
[output_pipe_filter.fifo]
    ↓
[output.csv]

# Assumptions
1. The system runs on Linux or WSL, with FIFO support.

2. CSV inputs are assumed to be mostly well-formed.

3. Processes properly handle EOF and pipe input.

4. Malformed lines are skipped without halting processing.

5. The pipeline is linear and sequential, but concurrency is tested in parallel scenarios.

# Requirements
Skills in Named Pipe both in C and Python
Python 3.7 or higher in PyCharm Community Edition
GCC (to compile the C source)
Linux or WSL environment
Setup of the WSL
SOLID Principles are not mandatory in this application


# Cleanup
Temporary files and named pipes are automatically removed by pipeline.py and run_all.sh.



# Linux pills

The typical C compiler in Linux system is gcc (GNU C Compiler)

Syntax to build a binary executable
 $ gcc-o <exec_name> <source_code>.c

Syntax to produce object code
 $ gcc-c <source_code>.c
 the output file is named <source_code>.o

Syntax to both build a binary executable and run it:
$ gcc <source_code>.c -o exe_name && ./exe_name

Syntax to install python:
$ sudo apt install python3-pip

Syntax to discover python version
$ python3 --version

Syntax to install gcc:
$ sudo apt update && sudo apt install build-essential

Syntax to install pandas:
$ sudo apt install python3-pandas

Syntax to run python script on bash (shell):
$ python3 pipeline.py

Syntax to know the state of WSL (e.g. Docker) on Windows PowerShell:
> wsl -l -v


## Particular case: aoa_to_1d.c  contains math.h (see below)

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>


Including  library  functions into  a program
gcc-o <exec> <source>.c -L<dir> -l<name>

The -l options is used to tell the compiler that  some functions in the source code have their 
object code in the lib<name>.a
 
the library is not in a standard directory, the directory must be specified through the  -L <dir>
option.

Standard libraries are part of the Operating System, while other 
libraries are distributed with the compiler; libcis the default C library containing input and output functions 
such as printf, scanf, open, read, write, etc.

Indeed, at first glance the syntax:

gcc -o aoa_to_1d aoa_to_1d.c

should be sufficient to correctly compile the file aoa_to_1d.c. However, in this case, it is necessary to add the -lm flag to link the math library (libm), and here is why "  gcc -o aoa_to_1d aoa_to_1d.c -lm  " is correct and mandatory!


